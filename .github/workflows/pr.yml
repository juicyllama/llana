#
# GitHub Actions workflow.
#
# Perfoms the following actions on a pull request:
# * Checkout the code
# * Install Node.js
# * Prepare the environment
# * Install dependencies
# * Lint the code
# * Run the tests
#

name: 'PR Checks: Llana'

on:
    pull_request:
        branches:
            - main
    workflow_dispatch:
    workflow_call:
jobs:
    docker_setup:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 18.18.2
                  cache: 'npm'
            - run: npm ci
            - run: npm run docker:dev

    lint:
        runs-on: ubuntu-latest
        needs: docker_setup
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 18.18.2
                  cache: 'npm'
            - run: npm ci
            - run: npm run lint

    test:
        runs-on: ubuntu-latest
        needs: docker_setup
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 18.18.2
                  cache: 'npm'
            - run: npm ci
            - run: npm run test
